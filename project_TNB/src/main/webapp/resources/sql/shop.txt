-- 카테고리 및 서비스 --
DROP SEQUENCE CATEGORY_SEQ;
CREATE SEQUENCE CATEGORY_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
;

DROP TABLE CATEGORY CASCADE CONSTRAINTS;
CREATE TABLE CATEGORY(
  CATEGORY_ID INT PRIMARY KEY,
  CATEGORY_NAME VARCHAR2(30) NOT NULL
);

DROP SEQUENCE SERVICE_SEQ;
CREATE SEQUENCE SERVICE_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
;

DROP TABLE SERVICE CASCADE CONSTRAINTS;
CREATE TABLE SERVICE(
  SERVICE_ID INT PRIMARY KEY,
  SERVICE_NAME VARCHAR2(50) NOT NULL,
  ICON VARCHAR2(50) NOT NULL
);

-- 시설 --
DROP SEQUENCE SHOP_SEQ;
CREATE SEQUENCE SHOP_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
;

DROP TABLE SHOP CASCADE CONSTRAINTS;
CREATE TABLE SHOP(
  SHOP_ID NUMBER,
  USER_ID NUMBER NOT NULL,
  SHOP_NAME VARCHAR2(60) NOT NULL,
  REGION VARCHAR2(30) NOT NULL,
  SHOP_ADDRESS VARCHAR2(100) NOT NULL,
  GRADE NUMBER DEFAULT 0 NOT NULL,
  REVIEW_COUNT NUMBER DEFAULT 0 NOT NULL,
  CATEGORY_ID NUMBER NOT NULL,
  SHOP_DATE DATE DEFAULT SYSDATE,
  CONSTRAINT SHOP_USER_ID_FK FOREIGN KEY(USER_ID) REFERENCES MEMBER(USER_ID) ON DELETE CASCADE,
  CONSTRAINT SHOP_CATEGORY_ID_FK FOREIGN KEY(CATEGORY_ID) REFERENCES CATEGORY(CATEGORY_ID) ON DELETE CASCADE,
  CONSTRAINT SHOP_PK PRIMARY KEY (SHOP_ID)
);

-- 시설_이용안내 --
DROP TABLE SHOP_GUIDE CASCADE CONSTRAINTS;
CREATE TABLE SHOP_GUIDE(
  GUIDE_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  GUIDE_TITLE VARCHAR2(90) NOT NULL,
  GUIDE_CONTENT VARCHAR2(200) NOT NULL,
  CONSTRAINT SHOP_GUIDE_SHOP_ID_FK FOREIGN KEY(SHOP_ID) REFERENCES SHOP(SHOP_ID) ON DELETE CASCADE,
  CONSTRAINT SHOP_GUIDE_PK PRIMARY KEY (GUIDE_ID,SHOP_ID)
);

-- 시설_이미지 --
DROP TABLE SHOP_IMAGE CASCADE CONSTRAINTS;
CREATE TABLE SHOP_IMAGE(
  SHOP_IMG_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  IMAGE VARCHAR2(90) NOT NULL,
  CONSTRAINT SHOP_IMAGE_SHOP_ID_FK FOREIGN KEY(SHOP_ID) REFERENCES SHOP(SHOP_ID) ON DELETE CASCADE,
  CONSTRAINT SHOP_IMAGE_PK PRIMARY KEY (SHOP_IMG_ID,SHOP_ID)
);

-- 시설_서비스 --
DROP TABLE SHOP_SERVICE CASCADE CONSTRAINTS;
CREATE TABLE SHOP_SERVICE(
  SERVICE_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  CONSTRAINT SHOP_SERVICE_SHOP_ID_FK FOREIGN KEY(SHOP_ID) REFERENCES SHOP(SHOP_ID) ON DELETE CASCADE,
  CONSTRAINT SHOP_SERVICE_SERVICE_ID_FK FOREIGN KEY(SERVICE_ID) REFERENCES SERVICE(SERVICE_ID) ON DELETE CASCADE,
  CONSTRAINT SHOP_SERVICE_PK PRIMARY KEY (SERVICE_ID,SHOP_ID)
);

-- 객실 --
DROP TABLE SHOP_ROOM CASCADE CONSTRAINTS;
CREATE TABLE SHOP_ROOM(
  ROOM_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  ROOM_NAME VARCHAR2(90) NOT NULL,
  PRICE NUMBER DEFAULT 0 NOT NULL,
  MAX_PEOPLE NUMBER DEFAULT 1 NOT NULL,
  STANDARD_PEOPLE NUMBER DEFAULT 1 NOT NULL,
  CHECK_IN NUMBER DEFAULT 9 NOT NULL,
  CHECK_OUT NUMBER DEFAULT 11 NOT NULL,
  ROOM_COUNT NUMBER DEFAULT 1 NOT NULL,
  CONSTRAINT SHOP_ROOM_SHOP_ID_FK FOREIGN KEY(SHOP_ID) REFERENCES SHOP(SHOP_ID) ON DELETE CASCADE,
  CONSTRAINT SHOP_ROOM_PK PRIMARY KEY (ROOM_ID,SHOP_ID)
);

-- 객실_이미지 --
DROP TABLE ROOM_IMAGE CASCADE CONSTRAINTS;
CREATE TABLE ROOM_IMAGE(
  ROOM_IMG_ID NUMBER NOT NULL,
  ROOM_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  IMAGE VARCHAR2(90) NOT NULL,
  CONSTRAINT ROOM_IMAGE_ROOM_ID_SHOP_ID_FK FOREIGN KEY(ROOM_ID,SHOP_ID) REFERENCES SHOP_ROOM(ROOM_ID,SHOP_ID) ON DELETE CASCADE,
  CONSTRAINT ROOM_IMAGE_PK PRIMARY KEY (ROOM_IMG_ID,ROOM_ID,SHOP_ID)
);

-- 객실_추가가격 --
DROP TABLE ROOM_PRICE CASCADE CONSTRAINTS;
CREATE TABLE ROOM_PRICE(
  PRICE_ID NUMBER NOT NULL,
  ROOM_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  PRICE NUMBER DEFAULT 0 NOT NULL,
  SUMMER_PEAK NUMBER DEFAULT 0 NOT NULL CHECK(SUMMER_PEAK IN(0,1)),
  WINTER_PEAK NUMBER DEFAULT 0 NOT NULL CHECK(WINTER_PEAK IN(0,1)),
  WEEKEND NUMBER DEFAULT 0 NOT NULL CHECK(WEEKEND IN(0,1)),
  CONSTRAINT ROOM_PRICE_ROOM_ID_SHOP_ID_FK FOREIGN KEY(ROOM_ID,SHOP_ID) REFERENCES SHOP_ROOM(ROOM_ID,SHOP_ID) ON DELETE CASCADE,
  CONSTRAINT ROOM_PRICE_PK PRIMARY KEY (PRICE_ID,ROOM_ID,SHOP_ID)
);

-- 리뷰 --
DROP SEQUENCE REVIEW_SEQ;
CREATE SEQUENCE REVIEW_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
;

DROP TABLE REVIEW CASCADE CONSTRAINTS;
CREATE TABLE REVIEW(
  REVIEW_ID NUMBER NOT NULL,
  ROOM_ID NUMBER NOT NULL,
  SHOP_ID NUMBER NOT NULL,
  USER_ID NUMBER NOT NULL,
  REVIEW_TITLE VARCHAR2(60) NOT NULL,
  REVIEW_CONTENT VARCHAR2(200) NOT NULL,
  GRADE NUMBER DEFAULT 0 NOT NULL,
  RECOMMEND NUMBER DEFAULT 0 NOT NULL,
  REVIEW_DATE DATE DEFAULT SYSDATE,
  CONSTRAINT REVIEW_USER_ID_FK FOREIGN KEY(USER_ID) REFERENCES MEMBER(USER_ID) ON DELETE CASCADE,
  CONSTRAINT REVIEW_ROOM_ID_SHOP_ID_FK FOREIGN KEY(ROOM_ID,SHOP_ID) REFERENCES SHOP_ROOM(ROOM_ID,SHOP_ID) ON DELETE CASCADE,
  CONSTRAINT REVIEW_PK PRIMARY KEY (REVIEW_ID)
);

--  리뷰_이미지 --
DROP TABLE REVIEW_IMAGE CASCADE CONSTRAINTS;
CREATE TABLE REVIEW_IMAGE(
  REVIEW_IMG_ID NUMBER NOT NULL,
  REVIEW_ID NUMBER NOT NULL,
  IMAGE VARCHAR2(90) NOT NULL,
  CONSTRAINT REVIEW_IMAGE_SHOP_ID_FK FOREIGN KEY(REVIEW_ID) REFERENCES REVIEW(REVIEW_ID) ON DELETE CASCADE,
  CONSTRAINT REVIEW_IMAGE_PK PRIMARY KEY (REVIEW_IMG_ID,REVIEW_ID)
);

-- 리뷰 추천 --
DROP TABLE REVIEW_RECOMMEND CASCADE CONSTRAINTS;
CREATE TABLE REVIEW_RECOMMEND(
  REVIEW_ID NUMBER NOT NULL,
  USER_ID NUMBER NOT NULL,
  CONSTRAINT REVIEW_RECOMMEND_USER_ID_FK FOREIGN KEY(USER_ID) REFERENCES MEMBER(USER_ID) ON DELETE CASCADE,
  CONSTRAINT REVIEW_RECOMMEND_IMAGE_SHOP_ID_FK FOREIGN KEY(REVIEW_ID) REFERENCES REVIEW(REVIEW_ID) ON DELETE CASCADE,
  CONSTRAINT REVIEW_RECOMMEND_PK PRIMARY KEY (REVIEW_ID,USER_ID)
);




