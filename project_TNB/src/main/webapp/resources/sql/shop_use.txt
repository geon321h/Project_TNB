-- 임시 -- 

DROP TABLE MEMBER CASCADE CONSTRAINTS;
CREATE TABLE MEMBER(
  USER_ID INT PRIMARY KEY
);
ALTER TABLE MEMBER ADD(USER_NAME VARCHAR2(60));
ALTER TABLE MEMBER ADD(USER_IMG VARCHAR2(90));

INSERT INTO MEMBER VALUES (1,'admin','profile_standard.svg');
-- UPDATE MEMBER SET USER_NAME = 'admin' ,USER_IMG = 'profile_standard.svg' WHERE USER_ID = 1;
INSERT INTO MEMBER VALUES (2,'떠나봄회원','profile_standard.svg');
-- UPDATE MEMBER SET USER_NAME = '떠나봄회원' ,USER_IMG = 'profile_standard.svg' WHERE USER_ID = 2;

SELECT * FROM MEMBER;

drop table room_reservation cascade constraints;
create table room_reservation(
   room_reservation_num number primary key,
   shop_id number not null,
   room_id number not null,
   room_checkin_date date,
   room_checkout_date date,
   room_reserve_quantity number,
   price number
   --,constraint room_reservation_shop_id_room_id foreign key (shop_id,room_id) references shop_room(shop_id,room_id) on delete cascade
) ;

INSERT INTO ROOM_RESERVATION VALUES (1,1,1,'2024/07/04','2024/07/06',1000,2);
INSERT INTO room_reservation VALUES (2,1,2,'2024/07/05','2024/07/06',1000,2);
INSERT INTO room_reservation VALUES (3,1,1,'2024/07/04','2024/07/06',1000,2);
INSERT INTO room_reservation VALUES (4,2,1,'2024/07/04','2024/07/05',1000,2);

SELECT * FROM ROOM_RESERVATION;

-- 시설 --
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'사우나','사우나_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'수영장','수영장_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'BBQ','BBQ_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'레스토랑','레스토랑_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'피트니스','피트니스_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'매점','매점_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'건조기','건조기_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'탈수기','탈수기_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'주방/식당','주방식당_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'공용샤워실','공용샤워실_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'공용화장실','공용화장실_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'조식포함','조식포함_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'무료주차','무료주차_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'주차장','주차장_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'캠프파이어','캠프파이어_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'객실내흡연','객실내흡연_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'반려견동반','반려견동반_icon');
INSERT INTO SERVICE VALUES (SERVICE_SEQ.NEXTVAL,'개인사물함','개인사물함_icon');
SELECT * FROM SERVICE;

INSERT INTO CATEGORY VALUES (CATEGORY_SEQ.NEXTVAL,'모텔');
INSERT INTO CATEGORY VALUES (CATEGORY_SEQ.NEXTVAL,'호텔·리조트');
INSERT INTO CATEGORY VALUES (CATEGORY_SEQ.NEXTVAL,'펜션·풀빌라');
INSERT INTO CATEGORY VALUES (CATEGORY_SEQ.NEXTVAL,'캠핑');
INSERT INTO CATEGORY VALUES (CATEGORY_SEQ.NEXTVAL,'게스트하우스');
SELECT * FROM CATEGORY;


INSERT INTO SHOP(SHOP_ID,USER_ID,SHOP_NAME,REGION,SHOP_ADDRESS,SHOP_INFO,CATEGORY_ID) 
VALUES (SHOP_SEQ.NEXTVAL,1,'서울신라호텔','서울특별시','서울 중구 장충동2가 202','전통이라는 지붕 위에 모더니즘적 디자인 요소를 가미, 삶에 여유와 품격을 한층 높여 주는 프리미엄 라이프스타일 공간으로 변화를 거듭해 오는 세계 최고의 럭셔리 호텔입니다',2);
--UPDATE SHOP SET SHOP_INFO = '전통이라는 지붕 위에 모더니즘적 디자인 요소를 가미, 삶에 여유와 품격을 한층 높여 주는 프리미엄 라이프스타일 공간으로 변화를 거듭해 오는 세계 최고의 럭셔리 호텔입니다' WHERE SHOP_ID =1;
INSERT INTO SHOP_IMAGE
VALUES ((SELECT NVL(MAX(SHOP_IMG_ID),0)+1 FROM SHOP_IMAGE WHERE SHOP_ID = 1),1,'서울신라호텔1.png');

INSERT INTO SHOP_GUIDE
VALUES ((SELECT NVL(MAX(GUIDE_ID),0)+1 FROM SHOP_GUIDE WHERE SHOP_ID = 1),1
          ,'기본정보','체크인: 15:00 | 체크아웃: 11:00
            무료 Wi-Fi
            전 객실 금연
            주차 가능(객실당 1대 무료)
            자원재활용법을 준수하여 일회용품인 칫솔, 치약, 면도기는 무료 제공하지 않습니다
            환경보호를 위해 개별 지참을 부탁드립니다 (필요시 객실 내 비치된 유료 어메니티 키트를 이용해 주시기 바랍니다)');
            
INSERT INTO SHOP_GUIDE
VALUES ((SELECT NVL(MAX(GUIDE_ID),0)+1 FROM SHOP_GUIDE WHERE SHOP_ID = 1),1,
          '취소 및 환불 규정','[기본 취소 규정]
            체크인일 기준 1일 전 18시까지 : 100% 환불
            체크인일 기준 1일 전 18시 이후~당일 및 No-show : 최초 1일 숙박 요금의 90% 환불 (연박의 경우 최초 1일 90% 환불, 이후 일자 100% 환불)');            

INSERT INTO SHOP_SERVICE VALUES (1,1);
INSERT INTO SHOP_SERVICE VALUES (2,1);

INSERT INTO SHOP(SHOP_ID,USER_ID,SHOP_NAME,REGION,SHOP_ADDRESS,SHOP_INFO,CATEGORY_ID) 
VALUES (SHOP_SEQ.NEXTVAL,1,'신촌 바론드 호텔','서울특별시','서울 서대문구 창천동 29-11','전통이라는 지붕 위에 모더니즘적 디자인 요소를 가미, 삶에 여유와 품격을 한층 높여 주는 프리미엄 라이프스타일 공간으로 변화를 거듭해 오는 세계 최고의 럭셔리 호텔입니다',1);
INSERT INTO SHOP_SERVICE VALUES (1,2);

INSERT INTO SHOP(SHOP_ID,USER_ID,SHOP_NAME,REGION,SHOP_ADDRESS,CATEGORY_ID) 
VALUES (SHOP_SEQ.NEXTVAL,1,'신라 스테이 구로','서울특별시','서울 동작구 신대방동 698',1);
INSERT INTO SHOP_SERVICE VALUES (1,3);

SELECT * FROM SHOP;
SELECT * FROM SHOP_IMAGE;
SELECT * FROM SHOP_SERVICE;
SELECT * FROM SHOP_GUIDE;

INSERT INTO SHOP_ROOM(ROOM_ID,SHOP_ID,ROOM_NAME,PRICE,MAX_PEOPLE,STANDARD_PEOPLE,CHECK_IN,CHECK_OUT,ROOM_COUNT) 
VALUES ((SELECT NVL(MAX(ROOM_ID),0)+1 FROM SHOP_ROOM WHERE SHOP_ID = 1),1,'디럭스 더블',836000,3,2,14,11,2);

INSERT INTO ROOM_IMAGE
VALUES ((SELECT NVL(MAX(ROOM_IMG_ID),0)+1 FROM ROOM_IMAGE WHERE ROOM_ID = 1),1,1,'디럭스더블1.jpg');
INSERT INTO ROOM_IMAGE
VALUES ((SELECT NVL(MAX(ROOM_IMG_ID),0)+1 FROM ROOM_IMAGE WHERE ROOM_ID = 1),1,1,'디럭스더블2.jpg');

INSERT INTO SHOP_ROOM(ROOM_ID,SHOP_ID,ROOM_NAME,PRICE,MAX_PEOPLE,STANDARD_PEOPLE,CHECK_IN,CHECK_OUT,ROOM_COUNT) 
VALUES ((SELECT NVL(MAX(ROOM_ID),0)+1 FROM SHOP_ROOM WHERE SHOP_ID = 1),1,'비지니스 디럭스 트윈',895000,3,2,14,11,2);

INSERT INTO ROOM_IMAGE
VALUES ((SELECT NVL(MAX(ROOM_IMG_ID),0)+1 FROM ROOM_IMAGE WHERE ROOM_ID = 2),2,1,'비지니스디럭스트윈1.jpg');

INSERT INTO SHOP_ROOM(ROOM_ID,SHOP_ID,ROOM_NAME,PRICE,MAX_PEOPLE,STANDARD_PEOPLE,CHECK_IN,CHECK_OUT,ROOM_COUNT) 
VALUES ((SELECT NVL(MAX(ROOM_ID),0)+1 FROM SHOP_ROOM WHERE SHOP_ID = 2),2,'Standard',60000,2,2,23,13,1);

INSERT INTO SHOP_ROOM(ROOM_ID,SHOP_ID,ROOM_NAME,PRICE,MAX_PEOPLE,STANDARD_PEOPLE,CHECK_IN,CHECK_OUT,ROOM_COUNT) 
VALUES ((SELECT NVL(MAX(ROOM_ID),0)+1 FROM SHOP_ROOM WHERE SHOP_ID = 3),3,'스탠다드 더블',124000,2,2,15,12,4);

INSERT INTO SHOP_ROOM(ROOM_ID,SHOP_ID,ROOM_NAME,PRICE,MAX_PEOPLE,STANDARD_PEOPLE,CHECK_IN,CHECK_OUT,ROOM_COUNT) 
VALUES ((SELECT NVL(MAX(ROOM_ID),0)+1 FROM SHOP_ROOM WHERE SHOP_ID = 3),3,'스탠다드 트윈',124000,2,2,15,12,3);

SELECT * FROM SHOP_ROOM;
SELECT * FROM ROOM_IMAGE;

-- SELECT AVG(GRADE)GRADE_AVG FROM REVIEW;
-- UPDATE SHOP SET REVIEW_COUNT = 0,GRADE = 0 WHERE SHOP_ID = 1;

INSERT INTO REVIEW
VALUES (REVIEW_SEQ.NEXTVAL,1,1,1,1,
        '서울 장충동 부진이 언니네 신라호텔에 다녀왔어요.<br>뷰는 남산뷰와 영빈관뷰 둘중 하나라서 저는 영빈관뷰를 골랐어요.<br>서울 한복판에서 보는 한옥이 너무 멋스러웠고 이와 반대로 어반아일랜드는 놀이동산에 온 것 마냥 세상 힙한 분위기 였어요. 날씨도 받쳐주는 서울신라의 밤에는 에메랄드 빛 불이 들어온 남산타워도 봤어요.<br>정말 이런게 호캉스구나 싶게 음식 맛이며 직원분들의 세심한 케어 최고였어요.<br>한줄평 : 세계서 영향력 있는 여성 100인 파워 부진이 언니네서 영빈관뷰 보며 귀빈 대접 받았어요<br>',
        9.5,0,SYSDATE);
UPDATE SHOP SET REVIEW_COUNT = REVIEW_COUNT+1,GRADE = (SELECT AVG(GRADE)GRADE_AVG FROM REVIEW) WHERE SHOP_ID = 1;

INSERT INTO REVIEW_IMAGE
VALUES ((SELECT NVL(MAX(REVIEW_IMG_ID),0)+1 FROM REVIEW_IMAGE WHERE REVIEW_ID = 1),1,'서울신라호텔_review1_1.jpg');
INSERT INTO REVIEW_IMAGE
VALUES ((SELECT NVL(MAX(REVIEW_IMG_ID),0)+1 FROM REVIEW_IMAGE WHERE REVIEW_ID = 1),1,'서울신라호텔_review1_2.jpg');
INSERT INTO REVIEW_IMAGE
VALUES ((SELECT NVL(MAX(REVIEW_IMG_ID),0)+1 FROM REVIEW_IMAGE WHERE REVIEW_ID = 1),1,'서울신라호텔_review1_3.jpg');
INSERT INTO REVIEW_IMAGE
VALUES ((SELECT NVL(MAX(REVIEW_IMG_ID),0)+1 FROM REVIEW_IMAGE WHERE REVIEW_ID = 1),1,'서울신라호텔_review1_4.jpg');
INSERT INTO REVIEW_IMAGE
VALUES ((SELECT NVL(MAX(REVIEW_IMG_ID),0)+1 FROM REVIEW_IMAGE WHERE REVIEW_ID = 1),1,'서울신라호텔_review1_5.jpg');


INSERT INTO REVIEW
VALUES (REVIEW_SEQ.NEXTVAL,2,1,2,2,
        '서비스는 말할 필요없이 최고였습니다. 다만 객실내 세면대 근처에서 머리카락이 보여서 아쉬웠습니다. 룸서비스도 만족스러웠구요, 와인 사와서 얼음통이랑 와인잔 요청 드렸는데 잘 챙겨주셨습니다. 어반 아일랜드도 꽤 괜찮았어서 다음에도 오면 이용하고 싶네요.',
        8,0,SYSDATE);
UPDATE SHOP SET REVIEW_COUNT = REVIEW_COUNT+1,GRADE = (SELECT AVG(GRADE)GRADE_AVG FROM REVIEW) WHERE SHOP_ID = 1; 
INSERT INTO REVIEW_IMAGE
VALUES ((SELECT NVL(MAX(REVIEW_IMG_ID),0)+1 FROM REVIEW_IMAGE WHERE REVIEW_ID = 2),2,'서울신라호텔_review2_1.jpg');
INSERT INTO REVIEW_IMAGE
VALUES ((SELECT NVL(MAX(REVIEW_IMG_ID),0)+1 FROM REVIEW_IMAGE WHERE REVIEW_ID = 2),2,'서울신라호텔_review2_2.jpg');
INSERT INTO REVIEW_IMAGE
VALUES ((SELECT NVL(MAX(REVIEW_IMG_ID),0)+1 FROM REVIEW_IMAGE WHERE REVIEW_ID = 2),2,'서울신라호텔_review2_3.jpg');

SELECT * FROM REVIEW;
SELECT * FROM REVIEW_IMAGE;
SELECT * FROM SHOP;

----------------------------------------------------------------------------------------------------

SELECT T10.SHOP_ID,USER_ID,SHOP_NAME,SHOP_ADDRESS,GRADE,REVIEW_COUNT,CATEGORY_ID,PRICE,IMAGE 
		FROM (SELECT T12.SHOP_ID,MIN(PRICE) PRICE
		 	      	FROM (SELECT SHOP_ID,ROOM_ID,COUNT(ROOM_ID) CNT
					            FROM ROOM_RESERVATION
					            WHERE ROOM_CHECKOUT_DATE >= '2024/07/04'
					            AND room_checkin_date <= '2024/07/06' 
					            GROUP BY SHOP_ID, ROOM_ID) T11
            		RIGHT OUTER JOIN
					            (SELECT *
					            FROM SHOP_ROOM) T12
		            ON T12.SHOP_ID = T11.SHOP_ID 
		            AND T12.ROOM_ID = T11.ROOM_ID
		            WHERE MAX_PEOPLE >= 2
		            AND ROOM_COUNT > NVL(CNT,0)
		            GROUP BY T12.SHOP_ID) T10,
		      		(SELECT T21.SHOP_ID,USER_ID,SHOP_NAME,SHOP_ADDRESS,GRADE,REVIEW_COUNT,CATEGORY_ID,REGION,IMAGE 
					FROM SHOP T21 
					    LEFT OUTER JOIN 
					    (SELECT * 
					      FROM SHOP_IMAGE 
					      WHERE SHOP_IMG_ID = 1) T22 
					ON T22.SHOP_ID = T21.SHOP_ID) T20
		WHERE T10.SHOP_ID = T20.SHOP_ID 
		AND (SHOP_NAME LIKE '%서%'
		    OR SHOP_ADDRESS LIKE '%서%'
		    OR REGION LIKE'%서%');

SELECT * 
FROM (SELECT * 
      FROM SHOP 
      WHERE SHOP_ID = 1) T10,
      CATEGORY T20
WHERE T10.CATEGORY_ID = T20.CATEGORY_ID;

SELECT IMAGE
FROM SHOP_IMAGE
WHERE SHOP_ID = 1;

SELECT SERVICE_NAME,ICON
FROM (SELECT * 
      FROM SHOP_SERVICE 
      WHERE SHOP_ID = 1) T10,
      SERVICE T20
WHERE T10.SERVICE_ID = T20.SERVICE_ID;

SELECT *
		FROM SHOP_GUIDE
		WHERE SHOP_ID = 1;
    
    
SELECT T20.SHOP_ID, T20.ROOM_ID,ROOM_NAME,PRICE,MAX_PEOPLE,STANDARD_PEOPLE,CHECK_IN,CHECK_OUT,(ROOM_COUNT-NVL(CNT,0))ROOM_COUNT,IMAGE
		 	      	FROM (SELECT SHOP_ID,ROOM_ID,COUNT(ROOM_ID) CNT
					            FROM ROOM_RESERVATION
					            WHERE ROOM_CHECKOUT_DATE >= '2024/07/04'
					            AND ROOM_CHECKIN_DATE <= '2024/07/06' 
					            GROUP BY SHOP_ID, ROOM_ID) T10
            		RIGHT OUTER JOIN
					            (SELECT SHOP_ID, T21.ROOM_ID,ROOM_NAME,PRICE,MAX_PEOPLE,STANDARD_PEOPLE,CHECK_IN,CHECK_OUT,ROOM_COUNT,IMAGE
					            FROM SHOP_ROOM T21
                      LEFT OUTER JOIN 
                          (SELECT ROOM_ID,IMAGE 
                           FROM ROOM_IMAGE
                           WHERE ROOM_IMG_ID =1) T22
                      ON T21.ROOM_ID = T22.ROOM_ID
                      WHERE T21.SHOP_ID = 1) T20
		            ON T20.SHOP_ID = T10.SHOP_ID 
		            AND T20.ROOM_ID = T10.ROOM_ID;
    
SELECT ROOM_ID,SHOP_ID,IMAGE
FROM ROOM_IMAGE
WHERE SHOP_ID = 1
ORDER BY ROOM_IMG_ID; 

SELECT REVIEW_ID,T10.ROOM_ID,T10.SHOP_ID,T10.USER_ID,REVIEW_CONTENT,GRADE,RECOMMEND,REVIEW_DATE,USER_NAME,USER_IMG,ROOM_NAME
FROM (SELECT REVIEW_ID,ROOM_ID,SHOP_ID,T11.USER_ID,REVIEW_CONTENT,GRADE,RECOMMEND,REVIEW_DATE,USER_NAME,USER_IMG
      FROM REVIEW T11
          ,MEMBER T12
      WHERE T11.USER_ID = T12.USER_ID) T10
      ,SHOP_ROOM T20
WHERE T10.ROOM_ID = T20.ROOM_ID
AND T10.SHOP_ID = T20.SHOP_ID
AND T10.SHOP_ID = 1;

SELECT REVIEW_IMG_ID,T10.REVIEW_ID,IMAGE
FROM REVIEW_IMAGE T10
    ,REVIEW T20
WHERE T10.REVIEW_ID = T20.REVIEW_ID
AND SHOP_ID = 1
ORDER BY REVIEW_IMG_ID; 



					            

SELECT T10.SHOP_ID,USER_ID,SHOP_NAME,SHOP_ADDRESS,GRADE,REVIEW_COUNT,REGION,PRICE,IMAGE,CATEGORY_NAME  
FROM (SELECT T12.SHOP_ID,USER_ID,SHOP_NAME,SHOP_ADDRESS,GRADE,REVIEW_COUNT,REGION,PRICE,CATEGORY_NAME 
      FROM(SELECT T11_1.SHOP_ID,CATEGORY_NAME, MIN(PRICE) PRICE
            FROM (SELECT T11_11.SHOP_ID,USER_ID,SHOP_NAME,SHOP_ADDRESS,GRADE,REVIEW_COUNT,REGION,CATEGORY_NAME 
                  FROM SHOP T11_11
                      ,CATEGORY T11_12
                  WHERE T11_11.CATEGORY_ID = T11_12.CATEGORY_ID) T11_1
                  ,SHOP_ROOM T11_2
            WHERE T11_1.SHOP_ID =  T11_2.SHOP_ID
            GROUP BY T11_1.SHOP_ID ,CATEGORY_NAME) T11
            ,SHOP T12
            WHERE T11.SHOP_ID = T12.SHOP_ID) T10 
LEFT OUTER JOIN 
      (SELECT * 
       FROM SHOP_IMAGE 
      WHERE SHOP_IMG_ID = 1) T20
ON T10.SHOP_ID = T20.SHOP_ID
WHERE SHOP_ADDRESS LIKE '%'||''||'%';

SELECT REVIEW_ID,ROOM_ID,T10.SHOP_ID,SHOP_NAME,T10.USER_ID,RESERVATION_ID,REVIEW_CONTENT,T10.GRADE,RECOMMEND,REVIEW_DATE
FROM (SELECT *
      FROM REVIEW
      WHERE REVIEW_ID = 1) T10
      ,SHOP T20
WHERE T10.SHOP_ID = T20.SHOP_ID;
      




